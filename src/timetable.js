import axios from "axios";
export default async function () {
  const todayIsHoliday = await isHoliday(new Date());
  var t = timetables.filter((item) => item.isHoliday === todayIsHoliday);
  return t.map((item) => {
    return item.timetable.map((i) => {
      return {
        time: makeDate(i),
        line: item.line,
        direction: item.direction,
        style:item.style,
      };
    });
  })
    .flat()
    .sort((a, b) => {
      if (a.time < b.time) {
        return -1;
      }
      if (a.time > b.time) {
        return 1;
      }
      return 0;
    });
}


var holidays;
async function getHolidays() {
  if (!holidays) {
    const h = await axios.get(
      "https://holidays-jp.github.io/api/v1/datetime.json"
    );
    holidays = Object.keys(h).map((str) => parseInt(str) / 1000);
  }
  return holidays;
}

async function isHoliday(date) {
  if (date.getDay() === 0 || date.getDay() === 6) {
    return true;
  }
  const d = parseInt(date.getTime() / 1000000);
  return (await getHolidays()).includes(d);
}

function makeDate(time) {
  const t = time.split(":");
  var date = new Date();
  if(parseInt(t[0],10)===0){
    date.setDate(date.getDate()+1)
  }
  date.setHours(t[0]);
  date.setMinutes(t[1]);
  return date;
}
const timetables = [
  {
    isHoliday: true,
    line: "⇐ブルーライン",
    style:"blue",
    direction: "↑あざみ野",
    timetable: [
      "05:20",
      "05:35",
      "05:47",
      "05:57",
      "06:07",
      "06:19",
      "06:33",
      "06:40",
      "07:02",
      "07:10",
      "07:18",
      "07:26",
      "08:02",
      "08:09",
      "08:15",
      "08:21",
      "09:02",
      "09:09",
      "09:16",
      "09:23",
      "10:00",
      "10:07",
      "10:18",
      "10:27",
      "11:03",
      "11:10",
      "11:18",
      "11:27",
      "12:03",
      "12:11",
      "12:18",
      "12:27",
      "13:03",
      "13:11",
      "13:18",
      "13:27",
      "14:03",
      "14:11",
      "14:18",
      "14:27",
      "15:03",
      "15:11",
      "15:18",
      "15:27",
      "16:03",
      "16:11",
      "16:18",
      "16:27",
      "17:03",
      "17:11",
      "17:18",
      "17:27",
      "18:03",
      "18:11",
      "18:18",
      "18:27",
      "19:03",
      "19:11",
      "19:18",
      "19:27",
      "20:03",
      "20:12",
      "20:19",
      "20:27",
      "21:04",
      "21:11",
      "21:19",
      "21:26",
      "22:07",
      "22:16",
      "22:24",
      "22:35",
      "23:10",
      "23:20",
      "23:30",
      "23:42",
      "00:08",
      "00:23",
    ],
  },
  {
    isHoliday: false,
    line: "⇐ブルーライン",
    style:"blue",
    direction: "↑あざみ野",
    timetable: [
      '05:20','05:35','05:47','05:57','06:06','06:14','06:19','06:26','07:03','07:07','07:12','07:16','08:03','08:07','08:12','08:16','09:01','09:06','09:10','09:15','10:04','10:12','10:19','10:26','11:03','11:11','11:18','11:27','12:03','12:11','12:18','12:27','13:03','13:11','13:18','13:27','14:03','14:11','14:18','14:27','15:03','15:11','15:18','15:27','16:04','16:12','16:18','16:24','17:01','17:08','17:14','17:20','18:05','18:11','18:17','18:22','19:04','19:10','19:16','19:22','20:04','20:10','20:16','20:22','21:04','21:10','21:16','21:22','22:03','22:11','22:18','22:24','23:05','23:16','23:26','23:34','00:02','00:12','00:25','00:38'
    ],
  },
  {
    isHoliday: false,
    line: "左ブルーライン",
    style:"blue",
    direction: "↓湘南 踊場",
    timetable: [
      '05:21','05:30','05:43','05:55','06:07','06:15','06:24','06:28','07:02','07:08','07:13','07:17','08:03','08:07','08:12','08:17','09:01','09:06','09:10','09:15','10:06','10:13','10:21','10:28','11:06','11:13','11:20','11:27','12:06','12:13','12:20','12:27','13:06','13:13','13:20','13:28','14:06','14:13','14:20','14:28','15:06','15:13','15:20','15:28','16:06','16:12','16:18','16:25','17:06','17:11','17:17','17:24','18:00','18:06','18:12','18:19','19:00','19:06','19:12','19:18','20:00','20:06','20:12','20:18','21:00','21:06','21:11','21:18','22:03','22:11','22:20','22:27','23:00','23:12','23:21','23:34','00:08','00:19','00:29','00:43',
    ],
  },
  {
    isHoliday: true,
    line: "⇐ブルーライン",
    style:"blue",
    direction: "↓湘南 踊場",
    timetable: [
      '05:21','05:30','05:43','05:53','06:06','06:17','06:27','06:35','07:04','07:12','07:19','07:27','08:04','08:11','08:18','08:26','09:04','09:10','09:16','09:22','10:06','10:13','10:21','10:29','11:06','11:13','11:20','11:28','12:06','12:13','12:20','12:28','13:06','13:13','13:20','13:28','14:06','14:13','14:20','14:28','15:06','15:13','15:20','15:28','16:06','16:13','16:20','16:28','17:06','17:13','17:20','17:28','18:06','18:13','18:20','18:28','19:06','19:13','19:20','19:27','20:06','20:13','20:22','20:29','21:07','21:16','21:25','21:33','22:07','22:19','22:31','22:37','23:06','23:18','23:34','23:49','00:00','00:10','00:25',
    ],
  },
  {
    isHoliday: true,
    line: "グリーンライン⇒",
    style:"green",
    direction: "↓中山",
    timetable: [
      '05:28','05:40','05:52','06:04','06:16','06:28','06:40','07:00','07:08','07:16','07:23','08:03','08:10','08:18','08:25','09:03','09:10','09:18','09:25','10:03','10:10','10:18','10:25','11:03','11:10','11:18','11:25','12:03','12:10','12:18','12:25','13:03','13:10','13:18','13:25','14:03','14:10','14:18','14:25','15:03','15:10','15:18','15:25','16:03','16:10','16:18','16:25','17:03','17:10','17:18','17:25','18:03','18:10','18:18','18:25','19:03','19:10','19:18','19:25','20:03','20:10','20:18','20:25','21:03','21:12','21:21','21:31','22:01','22:11','22:21','22:33','23:09','23:21','23:33','23:45','00:08','00:23','00:41',
    ],
  },
  {
    isHoliday:false,
    line: "グリーンライン⇒",
    style:"green",
    direction: "↓中山",
    timetable: [
      '05:28','05:38','05:48','05:59','06:07','06:17','06:24','06:31','07:06','07:09','07:13','07:16','08:02','08:05','08:09','08:12','09:01','09:05','09:09','09:13','10:05','10:11','10:18','10:25','11:03','11:10','11:18','11:25','12:03','12:10','12:18','12:25','13:03','13:10','13:18','13:25','14:03','14:10','14:18','14:25','15:03','15:10','15:18','15:25','16:02','16:10','16:18','16:25','17:01','17:08','17:14','17:21','18:03','18:09','18:15','18:21','19:03','19:09','19:15','19:21','20:03','20:09','20:15','20:21','21:03','21:09','21:15','21:21','22:03','22:09','22:15','22:21','23:06','23:13','23:22','23:30','00:04','00:13','00:23','00:33',
    ],
  },
  {
    isHoliday: true,
    line: "グリーンライン⇒",
    style:"green",
    direction: "↑日吉",
    timetable: [
      '05:15','05:28','05:40','05:52','06:04','06:15','06:28','06:38','07:07','07:15','07:23','07:31','08:01','08:08','08:15','08:23','09:00','09:08','09:15','09:23','10:00','10:08','10:15','10:23','11:00','11:08','11:15','11:23','12:00','12:08','12:15','12:23','13:00','13:08','13:15','13:23','14:00','14:08','14:15','14:23','15:00','15:08','15:15','15:23','16:00','16:08','16:15','16:23','17:00','17:08','17:15','17:23','18:00','18:08','18:15','18:23','19:00','19:08','19:15','19:23','20:00','20:08','20:15','20:23','21:00','21:10','21:20','21:30','22:00','22:10','22:20','22:29','23:03','23:15','23:27','23:39','00:09',
    ],
  },
  {
    isHoliday:false,
    line: "グリーンライン⇒",
    style:"green",
    direction: "↑日吉",
    timetable: [
      '05:15','05:26','05:37','05:46','06:02','06:07','06:17','06:24','07:00','07:04','07:07','07:11','08:00','08:03','08:07','08:10','09:00','09:06','09:12','09:17','10:01','10:08','10:15','10:23','11:00','11:08','11:15','11:23','12:00','12:08','12:15','12:23','13:00','13:08','13:15','13:23','14:00','14:08','14:15','14:23','15:00','15:08','15:15','15:23','16:00','16:08','16:16','16:23','17:06','17:14','17:20','17:26','18:03','18:09','18:15','18:21','19:03','19:09','19:15','19:21','20:03','20:09','20:15','20:21','21:03','21:09','21:15','21:21','22:03','22:09','22:15','22:21','23:00','23:08','23:17','23:25','00:00','00:10','00:22',
    ],
  },

];
